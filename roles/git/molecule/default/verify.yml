---
- name: Verify git role
  hosts: all
  gather_facts: true
  become: false
  tasks:
    # .zshrc
    - name: Verify .zshrc exists
      ansible.builtin.command:
        cmd: test -f {{ ansible_env.HOME }}/.zshrc
      changed_when: false

    # Ansible managed block configuration
    - name: Verify Ansible managed block is properly configured in .zshrc
      ansible.builtin.shell: |
        grep -q "# BEGIN ANSIBLE MANAGED BLOCK - Devbox configuration" {{ ansible_env.HOME }}/.zshrc &&
        grep -q "# END ANSIBLE MANAGED BLOCK - Devbox configuration" {{ ansible_env.HOME }}/.zshrc &&
        grep -q 'source.*dotfile/zsh/.zshrc' {{ ansible_env.HOME }}/.zshrc
      changed_when: false

    # git aliases
    - name: Verify git aliases are configured in dotfile
      ansible.builtin.shell: |
        grep -q "alias gb=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gc=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gl=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gp=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gph=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gs=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gsa=" "{{ playbook_dir }}/dotfile/zsh/.zshrc" &&
        grep -q "alias gr=" "{{ playbook_dir }}/dotfile/zsh/.zshrc"
      register: git_aliases_check
      changed_when: false
      failed_when: git_aliases_check.rc != 0
      args:
        executable: /bin/bash

    - name: Display git aliases
      ansible.builtin.debug:
        msg: "Git aliases are configured successfully"
